name: Update Dependencies
on:
  schedule:
    - cron: "15 7 * * 1-5" # Mon-Fri 3:15am EDT/2:15am EST
  workflow_dispatch:
jobs:
  update:
    name: Update Dependencies
    timeout-minutes: 30
    runs-on: [self-hosted, Linux, AWS]
    steps:
      - name: Checkout
        uses: Brightspace/third-party-actions@actions/checkout
        with:
          token: ${{secrets.PR_GITHUB_TOKEN}}
      - name: Set up node
        uses: Brightspace/third-party-actions@actions/setup-node
        with:
          node-version-file: .nvmrc
      - name: Add CodeArtifact npm registry
        uses: Brightspace/codeartifact-actions/npm/add-registry@main
        with:
          auth-token: ${{secrets.CODEARTIFACT_AUTH_TOKEN}}
      - name: Update package-lock.json
        uses: BrightspaceUI/actions/update-package-lock@main
        with:
          APPROVAL_TOKEN: ${{secrets.GITHUB_TOKEN}}
          AUTO_MERGE_TOKEN: ${{secrets.PR_GITHUB_TOKEN}}
          AUTO_MERGE_METHOD: squash
          GITHUB_TOKEN: ${{secrets.PR_GITHUB_TOKEN}}
          SLACK_CHANNEL_FAILURE: '#voyager-alerts'
          SLACK_CHANNEL_STALE_PR: '#voyager-alerts'
          SLACK_TOKEN: ${{ secrets.D2L_SLACK_TOKEN }}